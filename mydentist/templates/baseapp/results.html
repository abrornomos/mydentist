{% extends authenticated|yesno:'app_user.html,app.html' %}
{% load static i18n %}

{% block title %}
	{% trans "So'rov natijalari" %}
{% endblock %}

{% block content %}
	{% if results %}
		<div class="filter">
			<div class="container">
				<ul class="nav nav-pills my_select mx-auto mb-3" id="pills-tab" role="tablist">
					<li class="nav-item my_select_item" role="presentation">
						<button class="nav-link active" id="pills-list-tab" data-bs-toggle="pill" data-bs-target="#pills-list" type="button" role="tab" aria-controls="pills-list" aria-selected="true">Список</button>
					</li>
					<li class="nav-item my_select_item" role="presentation">
						<button class="nav-link" id="pills-map-tab" data-bs-toggle="pill" data-bs-target="#pills-map" type="button" role="tab" aria-controls="pills-map" aria-selected="true">Карта</button>
					</li>
				</ul>
			</div>
		</div>
		<div class="container">
			<div class="tab-content" id="pills-tabContent-1">
				<div class="tab-pane fade show active" id="pills-list" role="tabpanel" aria-labelledby="pills-list-tab">
					<div class="filter_holder">
						<div class="checkers_filter">
							<div class="container">
								<div class="checker">
									<ul class="nav nav-pills my_select mx-auto mb-3" id="pills-tab" role="tablist">
										<li class="nav-item my_select_item" role="presentation">
											<button class="nav-link active" id="pills-price-tab" data-bs-toggle="pill" data-bs-target="#pills-price" type="button" role="tab" aria-controls="pills-price" aria-selected="true">По цене</button>
										</li>
										<li class="nav-item my_select_item" role="presentation">
											<button class="nav-link" id="pills-near-tab" data-bs-toggle="pill" data-bs-target="#pills-near" type="button" role="tab" aria-controls="pills-near" aria-selected="true">По близости</button>
										</li>
									</ul>
								</div>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="gender" id="male" value="1" checked>
								<label class="form-check-label" for="male">Мужчина</label>
							</div>
							<div class="form-check form-check-inline">
								<input class="form-check-input" type="radio" name="gender" id="female" value="2">
								<label class="form-check-label" for="female">Женщина</label>
							</div>
							<div class="form-check checker">
								<input class="form-check-input" type="checkbox" id="time">
								<label class="form-check-label" for="time">24 Часа</label>
							</div>
						</div>
					</div>
					<div class="tab-content" id="pills-tabContent-2">
						<div class="tab-pane fade show active" id="pills-price" role="tabpanel" aria-labelledby="pills-price-tab">
							<div class="row">
								{% for result in results_by_price %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}<div class="col-md-4 col-sm-12">
									<div class="stom_card">
										<div class="card_img_holder">
											<img src="/media/{{ result.dentist_extra.image }}">
										</div>
										<div class="card_clinic">
											{{ result.clinic.name }}
										</div>
										<div class="card_info">
											{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}
										</div>
										<div class="card_info">
											{% trans "Manzil:" %} {{ result.clinic.address }}
										</div>
										{% if result.clinic.orientir %}<div class="card_info">
											{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}
										</div>{% endif %}
										<div class="card_info">
											{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}
										</div>
										<div class="card_info">
											{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}
										</div>
										<div class="btn_holder">
											<a href="{% url 'dentist:dentist' slug=result.dentist_extra.slug %}" class="btn my_btn_2">{% trans "Narxlarni ko'rish" %}</a>
											<a href="{% url 'dentist:dentist' slug=result.dentist_extra.slug %}" class="btn my_btn_2">{% trans "Qabulga yozilish" %}</a>
										</div>
									</div>
								</div>{% endif %}{% endfor %}
							</div>
						</div>
						<div class="tab-pane fade" id="pills-near" role="tabpanel" aria-labelledby="pills-near-tab">
							<div class="row">
								{% for result in results_by_distance %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}<div class="col-md-4 col-sm-12">
									<div class="stom_card">
										<div class="card_img_holder">
											<img src="/media/{{ result.dentist_extra.image }}">
										</div>
										<div class="card_clinic">
											{{ result.clinic.name }}
										</div>
										<div class="card_info">
											{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}
										</div>
										<div class="card_info">
											{% trans "Manzil:" %} {{ result.clinic.address }}
										</div>
										{% if result.clinic.orientir %}<div class="card_info">
											{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}
										</div>{% endif %}
										<div class="card_info">
											{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}
										</div>
										<div class="card_info">
											{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}
										</div>
										<div class="btn_holder">
											<a href="{% url 'dentist:dentist' slug=result.dentist_extra.slug %}" class="btn my_btn_2">{% trans "Narxlarni ko'rish" %}</a>
											<a href="{% url 'dentist:dentist' slug=result.dentist_extra.slug %}" class="btn my_btn_2">{% trans "Qabulga yozilish" %}</a>
										</div>
									</div>
								</div>{% endif %}{% endfor %}
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane fade" id="pills-map" role="tabpanel" aria-labelledby="pills-map-tab">
					<div class="map mb-4">
						<div class="big_title">{% trans "Xaritada joylashuv" %}</div>
						<div class="container">
							<div id="map"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	{% else %}
		<div class="big_title mt-4 mb-4">
			{% trans "Kechirasiz, sizning so'rovingiz bo'yicha tish shifokorlari topilmadi" %}
		</div>
	{% endif %}
{% endblock %}

{% block javascript %}
	<script src="https://api-maps.yandex.ru/2.1/?apikey=9c44946f-08f3-4e0d-a8e0-12aad041b5ff&lang=ru_RU"></script>
	<script type="text/javascript">
		$("input[type=radio]").on("click", getResults)
		$("input[type=checkbox]").on("click", getResults)
		function getResults() {
			if ($("input[type=checkbox]").is(":checked")) {
				if ($("#pills-price").is(".active")) {
					getResultsByPrice(true)
				} else if ($("#pills-near").is(".active")) {
					getResultsByDistance(true)
				}
			} else {
				if ($("#pills-price").is(".active")) {
					getResultsByPrice(false)
				} else if ($("#pills-near").is(".active")) {
					getResultsByDistance(false)
				}
			}
		}
		function getResultsByPrice(checkbox) {
			if (checkbox) {
				if ($("input[type=radio]:checked")[0].value == 1) {
					$("#pills-price .row").empty()
					{% for result in results_by_price %}{% if result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}$("#pills-price .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {% trans "24 soat" %}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				} else if ($("input[type=radio]:checked")[0].value == 2) {
					$("#pills-price .row").empty()
					{% for result in results_by_price %}{% if result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 2 %}$("#pills-price .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {% trans "24 soat" %}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				}
			} else {
				if ($("input[type=radio]:checked")[0].value == 1) {
					$("#pills-price .row").empty()
					{% for result in results_by_price %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}$("#pills-price .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				} else if ($("input[type=radio]:checked")[0].value == 2) {
					$("#pills-price .row").empty()
					{% for result in results_by_price %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 2 %}$("#pills-price .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					){% endif %}{% endfor %}
				}
			}
		}
		function getResultsByDistance(checkbox) {
			if (checkbox) {
				if ($("input[type=radio]:checked")[0].value == 1) {
					$("#pills-near .row").empty()
					{% for result in results_by_distance %}{% if result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}$("#pills-near .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {% trans "24 soat" %}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				} else if ($("input[type=radio]:checked")[0].value == 2) {
					$("#pills-near .row").empty()
					{% for result in results_by_distance %}{% if result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 2 %}$("#pills-near .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {% trans "24 soat" %}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				}
			} else {
				if ($("input[type=radio]:checked")[0].value == 1) {
					$("#pills-near .row").empty()
					{% for result in results_by_distance %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 1 %}$("#pills-near .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				} else if ($("input[type=radio]:checked")[0].value == 2) {
					$("#pills-near .row").empty()
					{% for result in results_by_distance %}{% if not result.dentist_extra.is_fullday and result.dentist_extra.gender_id == 2 %}$("#pills-near .row").append(
						$("<div></div>").addClass("col-md-4 col-sm-12").append(
							$("<div></div>").addClass("stom_card").append(
								$("<div></div>").addClass("card_img_holder").append(
									$("<img>").attr("src", "/media/{{ result.dentist_extra.image }}")
								)
							).append(
								$("<div></div>").addClass("card_clinic").html("{{ result.clinic.name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "FISh:" %} {{ result.dentist.last_name }} {{ result.dentist.first_name }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Manzil:" %} {{ result.clinic.address }}")
							){% if result.clinic.orientir %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Mo'ljal:" %} {{ result.clinic.orientir }}")
							){% endif %}.append(
								$("<div></div>").addClass("card_info").html("{% trans "Ishlash vaqti:" %} {{ result.dentist_extra.worktime_begin }} - {{ result.dentist_extra.worktime_end }}")
							).append(
								$("<div></div>").addClass("card_info").html("{% trans "Telefon raqami:" %} {{ result.dentist_extra.phone_number }}")
							).append(
								$("<div></div>").addClass("btn_holder").append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Narxlarni ko'rish" %}")
								).append(
									$("<a></a>").addClass("btn my_btn_2").attr("href", "{% url 'dentist:dentist' slug=result.dentist_extra.slug %}").html("{% trans "Qabulga yozilish" %}")
								)
							)
						)
					)
					{% endif %}{% endfor %}
				}
			}
		}
		ymaps.ready(init)
		function init() {
			let myMap = new ymaps.Map("map", {
				center: [40.767684, 72.336187],
				zoom: 10
			}), myGeoObject
			{% for result in results_by_price %}myGeoObject = new ymaps.GeoObject(
				{
					// Описание геометрии.
					geometry: {
						type: "Point",
						coordinates: [parseFloat("{{ result.clinic.latitude }}".replace(/,/, ".")), parseFloat("{{ result.clinic.longitude }}".replace(/,/, "."))]
					},
					// Свойства.
					properties: {
						// Контент метки.
						iconContent: "{{ result.clinic.name }}"
					}
				}, {
					// Опции.
					// Иконка метки будет растягиваться под размер ее содержимого.
					preset: 'islands#blackStretchyIcon'
				}
			)
			myMap.geoObjects.add(myGeoObject)
			{% endfor %}
		}
	</script>
{% endblock %}